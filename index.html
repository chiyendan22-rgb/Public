<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tranh B√° V√¥ Song</title>

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}

/* INTRO */
#intro{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10;
  animation:fadeOut 4s forwards;
}
#intro h1{
  color:red;
  font-size:40px;
  text-shadow:0 0 20px orange,0 0 40px red;
  animation:fire 1s infinite alternate;
}
@keyframes fire{
  from{ text-shadow:0 0 10px red;}
  to{ text-shadow:0 0 30px orange;}
}
@keyframes fadeOut{
  0%,70%{opacity:1}
  100%{opacity:0;visibility:hidden}
}

/* UI */
button{
  padding:10px;
  margin:5px;
  font-size:16px;
}
canvas{
  background:#2b2b2b;
  display:block;
  margin:auto;
  border:2px solid #444;
}
.panel{
  background:#111;
  padding:8px;
  margin:5px;
  border-radius:8px;
}
</style>
</head>

<body>

<div id="intro"><h1>TR·∫†NH B√Å V√î SONG</h1></div>

<h2>Tranh B√° V√¥ Song</h2>

<button onclick="mute()">C√†i ƒë·∫∑t (√Çm thanh)</button>

<div class="panel" id="info"></div>

<canvas id="game" width="360" height="480"></canvas>

<div class="panel">
<button onclick="train('bo')">Hu·∫•n luy·ªán B·ªô binh</button>
<button onclick="train('ky')">Hu·∫•n luy·ªán K·ªµ binh</button>
<button onclick="upgradeHero()">N√¢ng c·∫•p Nh√¢n v·∫≠t</button>
<button onclick="attackCity()">T·∫•n c√¥ng</button>
</div>

<audio id="click" src="https://cdn.pixabay.com/audio/2022/03/10/audio_2d68c8b6df.mp3"></audio>
<audio id="war" src="https://cdn.pixabay.com/audio/2021/08/04/audio_3c6c81e95c.mp3"></audio>

<script>
/* ===== DATA ===== */
let go=100, sat=50, vang=50;
let bo=5, ky=2;
let heroPower=10;
let general={level:1, atk:5, hp:100};

let enemyCity=60;

/* ===== SAVE / LOAD ===== */
function saveGame(){
  localStorage.setItem("tranhba_save",JSON.stringify({
    go,sat,vang,bo,ky,heroPower,general,enemyCity
  }));
}
function loadGame(){
  let s=localStorage.getItem("tranhba_save");
  if(s){
    let d=JSON.parse(s);
    Object.assign(window,d);
  }
}

/* ===== UI ===== */
function updateUI(){
  document.getElementById("info").innerHTML=
  `üå≤ G·ªó:${go} ‚õì S·∫Øt:${sat} üí∞ V√†ng:${vang}<br>
   ü™ñ B·ªô:${bo} üêé K·ªµ:${ky}<br>
   üë§ S·ª©c m·∫°nh:${heroPower} | üëë T∆∞·ªõng ATK:${general.atk}`;
}
function play(id){document.getElementById(id).play();}
function mute(){document.querySelectorAll("audio").forEach(a=>a.muted=!a.muted);}

/* ===== ACTION ===== */
function train(type){
  play("click");
  if(type=="bo" && go>=10){go-=10;bo++;}
  if(type=="ky" && go>=20){go-=20;ky++;}
  updateUI(); saveGame();
}
function upgradeHero(){
  play("click");
  if(vang>=10){
    vang-=10;
    heroPower+=2;
    updateUI(); saveGame();
  }
}
function armyPower(){
  return bo*2 + ky*4 + heroPower + general.atk;
}
function attackCity(){
  play("war");
  if(armyPower()>enemyCity){
    alert("üèÜ Chi·∫øm th√†nh! C∆∞·ªõp t√†i nguy√™n");
    go+=30; vang+=20;
    enemyCity+=20;
  }else{
    alert("‚ùå Th·∫•t b·∫°i! M·∫•t qu√¢n");
    bo=Math.max(0,bo-2);
  }
  updateUI(); saveGame();
}

/* ===== MAP ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const tile=60;
const mapW=6, mapH=8;
let map=[];
for(let y=0;y<mapH;y++){
  map[y]=[];
  for(let x=0;x<mapW;x++) map[y][x]=Math.floor(Math.random()*3);
}
let player={x:2,y:3};

canvas.addEventListener("touchstart",e=>{
  let t=e.touches[0];
  let x=Math.floor((t.clientX-canvas.offsetLeft)/tile);
  let y=Math.floor((t.clientY-canvas.offsetTop)/tile);
  if(x>=0&&y>=0&&x<mapW&&y<mapH){player.x=x;player.y=y;}
});

function drawMap(){
  for(let y=0;y<mapH;y++)for(let x=0;x<mapW;x++){
    ctx.fillStyle=["#2e7d32","#757575","#c0a16b"][map[y][x]];
    ctx.fillRect(x*tile,y*tile,tile,tile);
    ctx.strokeRect(x*tile,y*tile,tile,tile);
  }
}
function drawPlayer(){
  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(player.x*tile+30,player.y*tile+30,10,0,Math.PI*2);
  ctx.fill();
}
function render(){
  ctx.clearRect(0,0,360,480);
  drawMap(); drawPlayer();
}
setInterval(render,1000/30);

/* INIT */
loadGame();
updateUI();
setInterval(saveGame,5000);
</script>

</body>
</html>